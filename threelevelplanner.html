
<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>Three Level Planner</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <style type="text/css">
      @import url(http://fonts.googleapis.com/css?family=Droid+Serif);
      @import url(http://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
      @import url(http://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

      #threelevel {
        width: 300px;
        height: 300px;
      }
    </style>
  </head>
  <body>
    <script type="text/javascript">
$( document ).ready(function() {
  loadFile();
});

function loadFile() {
  $.get( "/classes/SVDA/three_level.txt", function( data ) {
    $( "#threelevel" ).text( data );
    
    showTime();
  });
}

function showTime() {
  var slidesPerHour = parseInt($( "#slidesperhour" ).val())
  var hoursPerDay = parseInt($( "#hoursperday" ).val())
  var demoMultiplier = parseInt($( "#demomultiplier" ).val())
  var exerciseMultiplier = parseInt($( "#exercisemultiplier" ).val())

  allLines = $( "#threelevel" ).text().split("\n")

  
  var chapters = -1;
  var sections = 0;
  var regular = 0;
  var demoMinutes = 0;
  var exerciseMinutes = 0;

  var currentSlides = 0;
  var currentDemoMinutes = 0;
  var currentExerciseMinutes = 0;
  var currentChapterName = ""

  var m;
  var demoRE = /#demo\s+(\d+)/;
  var exerciseRE = /#exercise\s+(\d+)/;

  for (var i = 0; i < allLines.length; i++) {
    // Process regular slides
    if (allLines[i].startsWith("    ")) {
      if ((m = demoRE.exec(allLines[i])) !== null) {
        var minutes = parseInt(m[1]) * demoMultiplier
        demoMinutes += minutes;
        currentDemoMinutes += minutes;
      } else if ((m = exerciseRE.exec(allLines[i])) !== null) {
        var minutes = parseInt(m[1]) * exerciseMultiplier
        exerciseMinutes += minutes;
        currentExerciseMinutes += minutes;
      } else {
        regular++;
        currentSlides++;
      }
    // Process sections
    } else if (allLines[i].startsWith("  ")) { 
      sections++;
    // Process chapters
    } else {
      chapters++;

      if (chapters != 0) {
        this.outputChapterTime(regular, demoMinutes, exerciseMinutes, slidesPerHour, chapters, currentChapterName, currentSlides, currentExerciseMinutes, currentDemoMinutes, hoursPerDay)

        currentSlides = 0;
        currentExerciseMinutes = 0;
        currentDemoMinutes = 0;
      }

      currentChapterName = allLines[i];
    }
  }

  outputChapterTime(regular, demoMinutes, exerciseMinutes, slidesPerHour, chapters, currentChapterName, currentSlides, currentExerciseMinutes, currentDemoMinutes, hoursPerDay)

  $( "#time" ).html("Overall stats chapters:" + chapters + " sections:" + sections +
   " regular:" + regular + " demos:" + demoMinutes + " exercises:" + exerciseMinutes +
   " slidesPerHour:" + slidesPerHour)
}

function outputChapterTime(regular, demoMinutes, exerciseMinutes, slidesPerHour, chapters, currentChapterName, currentSlides, currentExerciseMinutes, currentDemoMinutes, hoursPerDay) {
  var toLog = this.calculateTime(regular, demoMinutes, exerciseMinutes, slidesPerHour, hoursPerDay) + 
    " Chapter " + chapters + " " + currentChapterName +
    " - " + currentSlides + " slides."

  if (currentExerciseMinutes != 0) {
    toLog += " " + currentExerciseMinutes + " minutes of exercises."
  }

  if (currentDemoMinutes != 0) {
    toLog += " " + currentDemoMinutes + " minutes of demos."
  }

  toLog += " Total chapter time: " + ((currentSlides * (60 / slidesPerHour)) + currentExerciseMinutes + currentDemoMinutes).toFixed(0) + " minutes."

  return console.log(toLog)
}

// Calculates the current run time
function calculateTime(slides, demo, exercise, slidesPerHour) {
  var totalMinutes = ((slides / slidesPerHour) * 60) + demo + exercise
  var hoursPerDay = 4.0

  var days = Math.ceil(totalMinutes / (60 * hoursPerDay))

  var hours = (totalMinutes - ((days - 1) * hoursPerDay * 60)) / 60

  return "Day " + days + " " + hours.toFixed(2) + " hours"
}



    </script>
    
    Three Level:
    <textarea id="threelevel">Text</textarea>

    Hours Per Day:
    <input id="hoursperday" type="text" value="6.5">

    Slides Per Hour:
    <input id="slidesperhour" type="text" value="21">

    Demo Multiplier:
    <input id="demomultiplier" type="text" value="1">

    Exercise Multiplier:
    <input id="exercisemultiplier" type="text" value="1">

    Time:
    <div id="time"></div>

    <div>TODO: add slides to exercises ratio</div>
  </body>
</html>
